# 对联生成模型调研实验

中文对联生成任务，是文本生成中一个比较常见的任务。下面基于该任务做生成模型实验。

#### 目的：
1. 评测[textgen](https://github.com/shibing624/textgen)库的生成模型代码完整性及可用性；
2. 评测[GPT2](https://github.com/shibing624/textgen/tree/main/textgen/language_modeling)和[T5](https://github.com/shibing624/textgen/tree/main/textgen/t5)模型在对联生成上的效果，并对比两者的差异。


## 数据集

[couplet.tar.gz]https://github.com/wb14123/couplet-dataset/releases/download/1.0/couplet.tar.gz，包含770491个对联。

样本：
```shell
==> .//couplet_files/couplet/train/in.txt <==
晚 风 摇 树 树 还 挺 

==> .//couplet_files/couplet/train/out.txt <==
晨 露 润 花 花 更 红 
```


## T5模型

T5模型一种Encoder-Decoder架构，其中输入和输出都是文本序列。
这使它能够灵活地执行任何自然语言处理任务，而无需以任何方式修改模型架构。这也意味着训练一个T5模型可以同时执行多个任务，只需要给它不同*prefix*即可。

关于T5模型可以参考paper：*[Exploring the Limits of Transfer Learning with a Unified Text-to-Text Transformer](https://arxiv.org/abs/1910.10683)* paper for more details.

**Tip:** 这篇 [文章](https://towardsdatascience.com/asking-the-right-questions-training-a-t5-transformer-model-on-a-new-task-691ebba2d72c?source=friends_link&sk=9f88c539546eca32b702cc0243abd0dd) 介绍了训练T5模型来执行一个新任务

**Tip:** 这篇 [文章](https://towardsdatascience.com/the-guide-to-multi-tasking-with-the-t5-transformer-90c70a08837b?source=friends_link&sk=ffe37deefa8dd4158f3f76e3dd46cf11) 介绍了训练T5模型来执行多个任务的方法

#### 指定任务
T5模型可以在开头添加*prefix*来执行某个特定任务，同一个任务使用的*prefix*相同，对于多个任务，则使用不同的*prefix*区分。

Example *prefixes*:

1. `binary classification`
2. `predict sentiment`
3. `answer question`

预测时，模型将根据不同的*prefix*来生成相应的输出。

#### 使用步骤

使用步骤：

1. 初始化 `T5Model`
2. 训练模型 `train_model()`
3. 评估模型 `eval_model()`
4. 预测 `predict()`

### 训练及预测

查看[T5_Finetune_Chinese_Couplet.ipynb](https://github.com/shibing624/textgen/blob/main/examples/T5/T5_Finetune_Chinese_Couplet.ipynb)，里面包括训练和预测。


### 结果评估

|prefix|input_text|target_text|pred|
| :-- | :--- | :--- | :-- |
|对联：|书香醉我凌云梦|诗韵酬余壮志心|墨韵迷人醉月心|
|对联：|春回大地，对对黄莺鸣暖树|日照神州，群群紫燕衔新泥|福至人间,家家紫燕舞和风|
|对联：|松风吼夜潮，巧剜明月染春水|小阁烹香茗，闲对茶经忆古人|柳浪翻花浪,漫卷残阳湿画屏|
|对联：|庙貌遍海澨山陬，虽僻处剡西，犹不废千秋俎豆|志业在平吴抑魏，只乃心王室，洵足扶万古纲常|庙貌并云龙漳水,有灵山灵秀,更何分万古馨香|
|对联：|磊落|光明|清廉|
|对联：|伤积在骨何依托|情结成茧怎生抽|痛饮于胸不动摇|
|对联：|已彻骨深寒，倩影依稀，有我空庭长饮月|还伤情正浓，珠泪难拂，无君绣帘尽卷风|莫伤怀寂寞,愁容寂寞,无君旧梦又思乡|
|对联：|紫气蒸茶山，芽鲜叶秀|清泉润竹海，笋嫩篁幽|红霞映碧水,水秀山青|
|对联：|来生后世无因果|乱语胡言惹是非|东倒西歪有缘由|
|对联：|雪盖梅梢，愿与红颜同白首|霞披芦顶，心仪鹤发度金婚|风梳柳辫,愿同碧水共青天|

分析结果：




